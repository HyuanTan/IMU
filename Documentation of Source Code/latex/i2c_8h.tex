\section{C\+:/\+Users/\+Md. Istiaq Mahbub/\+Desktop/\+I\+M\+U/\+M\+P\+U6050\+\_\+\+Motion\+Driver/\+Peripheral/src/i2c.h File Reference}
\label{i2c_8h}\index{C\+:/\+Users/\+Md. Istiaq Mahbub/\+Desktop/\+I\+M\+U/\+M\+P\+U6050\+\_\+\+Motion\+Driver/\+Peripheral/src/i2c.\+h@{C\+:/\+Users/\+Md. Istiaq Mahbub/\+Desktop/\+I\+M\+U/\+M\+P\+U6050\+\_\+\+Motion\+Driver/\+Peripheral/src/i2c.\+h}}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \textbf{ S\+E\+N\+S\+O\+R\+S\+\_\+\+I2C}~\textbf{ I2\+C2}
\item 
\#define \textbf{ I2\+C\+\_\+\+S\+P\+E\+ED}~400000
\item 
\#define \textbf{ I2\+C\+\_\+\+O\+W\+N\+\_\+\+A\+D\+D\+R\+E\+SS}~0x00
\item 
\#define \textbf{ I2\+C\+\_\+\+Config}()~\textbf{ I2c\+Master\+\_\+\+Init}();
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \textbf{ I2c\+Master\+\_\+\+Init} (void)
\item 
void \textbf{ Set\+\_\+\+I2\+C\+\_\+\+Retry} (unsigned short ml\+\_\+sec)
\item 
unsigned short \textbf{ Get\+\_\+\+I2\+C\+\_\+\+Retry} ()
\item 
int \textbf{ Sensors\+\_\+\+I2\+C\+\_\+\+Read\+Register} (unsigned char Address, unsigned char Register\+Addr, unsigned short Register\+Len, unsigned char $\ast$Register\+Value)
\item 
int \textbf{ Sensors\+\_\+\+I2\+C\+\_\+\+Write\+Register} (unsigned char Address, unsigned char Register\+Addr, unsigned short Register\+Len, const unsigned char $\ast$Register\+Value)
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\mbox{\label{i2c_8h_aaade177dea4921da887f3c4c5b8f7bb4}} 
\index{i2c.\+h@{i2c.\+h}!I2\+C\+\_\+\+Config@{I2\+C\+\_\+\+Config}}
\index{I2\+C\+\_\+\+Config@{I2\+C\+\_\+\+Config}!i2c.\+h@{i2c.\+h}}
\subsubsection{I2\+C\+\_\+\+Config}
{\footnotesize\ttfamily \#define I2\+C\+\_\+\+Config(\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})~\textbf{ I2c\+Master\+\_\+\+Init}();}



Definition at line \textbf{ 14} of file \textbf{ i2c.\+h}.

\mbox{\label{i2c_8h_ab665b5b80f13670806350a6b460dad71}} 
\index{i2c.\+h@{i2c.\+h}!I2\+C\+\_\+\+O\+W\+N\+\_\+\+A\+D\+D\+R\+E\+SS@{I2\+C\+\_\+\+O\+W\+N\+\_\+\+A\+D\+D\+R\+E\+SS}}
\index{I2\+C\+\_\+\+O\+W\+N\+\_\+\+A\+D\+D\+R\+E\+SS@{I2\+C\+\_\+\+O\+W\+N\+\_\+\+A\+D\+D\+R\+E\+SS}!i2c.\+h@{i2c.\+h}}
\subsubsection{I2\+C\+\_\+\+O\+W\+N\+\_\+\+A\+D\+D\+R\+E\+SS}
{\footnotesize\ttfamily \#define I2\+C\+\_\+\+O\+W\+N\+\_\+\+A\+D\+D\+R\+E\+SS~0x00}



Definition at line \textbf{ 12} of file \textbf{ i2c.\+h}.

\mbox{\label{i2c_8h_a410dc1e7572425a449b5dc0f7ca9f69d}} 
\index{i2c.\+h@{i2c.\+h}!I2\+C\+\_\+\+S\+P\+E\+ED@{I2\+C\+\_\+\+S\+P\+E\+ED}}
\index{I2\+C\+\_\+\+S\+P\+E\+ED@{I2\+C\+\_\+\+S\+P\+E\+ED}!i2c.\+h@{i2c.\+h}}
\subsubsection{I2\+C\+\_\+\+S\+P\+E\+ED}
{\footnotesize\ttfamily \#define I2\+C\+\_\+\+S\+P\+E\+ED~400000}



Definition at line \textbf{ 11} of file \textbf{ i2c.\+h}.

\mbox{\label{i2c_8h_a8d4efa0b59643bca3dc9c486c0123060}} 
\index{i2c.\+h@{i2c.\+h}!S\+E\+N\+S\+O\+R\+S\+\_\+\+I2C@{S\+E\+N\+S\+O\+R\+S\+\_\+\+I2C}}
\index{S\+E\+N\+S\+O\+R\+S\+\_\+\+I2C@{S\+E\+N\+S\+O\+R\+S\+\_\+\+I2C}!i2c.\+h@{i2c.\+h}}
\subsubsection{S\+E\+N\+S\+O\+R\+S\+\_\+\+I2C}
{\footnotesize\ttfamily \#define S\+E\+N\+S\+O\+R\+S\+\_\+\+I2C~\textbf{ I2\+C2}}



Definition at line \textbf{ 9} of file \textbf{ i2c.\+h}.



\subsection{Function Documentation}
\mbox{\label{i2c_8h_a62f1734db1e997e848ee534e49a7736f}} 
\index{i2c.\+h@{i2c.\+h}!Get\+\_\+\+I2\+C\+\_\+\+Retry@{Get\+\_\+\+I2\+C\+\_\+\+Retry}}
\index{Get\+\_\+\+I2\+C\+\_\+\+Retry@{Get\+\_\+\+I2\+C\+\_\+\+Retry}!i2c.\+h@{i2c.\+h}}
\subsubsection{Get\+\_\+\+I2\+C\+\_\+\+Retry()}
{\footnotesize\ttfamily unsigned short Get\+\_\+\+I2\+C\+\_\+\+Retry (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line \textbf{ 408} of file \textbf{ i2c.\+c}.



References \textbf{ R\+E\+T\+R\+Y\+\_\+\+I\+N\+\_\+\+M\+L\+S\+EC}.



Referenced by \textbf{ Sensors\+\_\+\+I2\+C\+\_\+\+Read\+Register()}, and \textbf{ Sensors\+\_\+\+I2\+C\+\_\+\+Write\+Register()}.


\begin{DoxyCode}
00409 \{
00410   \textcolor{keywordflow}{return} RETRY_IN_MLSEC;
00411 \}
\end{DoxyCode}
\mbox{\label{i2c_8h_ae2b2e880b40601327a6ed3e146a84965}} 
\index{i2c.\+h@{i2c.\+h}!I2c\+Master\+\_\+\+Init@{I2c\+Master\+\_\+\+Init}}
\index{I2c\+Master\+\_\+\+Init@{I2c\+Master\+\_\+\+Init}!i2c.\+h@{i2c.\+h}}
\subsubsection{I2c\+Master\+\_\+\+Init()}
{\footnotesize\ttfamily void I2c\+Master\+\_\+\+Init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line \textbf{ 53} of file \textbf{ i2c.\+c}.



References \textbf{ E\+N\+A\+B\+LE}, \textbf{ G\+P\+I\+O\+\_\+\+Init()}, \textbf{ G\+P\+I\+O\+\_\+\+Init\+Type\+Def\+::\+G\+P\+I\+O\+\_\+\+Mode}, \textbf{ G\+P\+I\+O\+\_\+\+Mode\+\_\+\+AF}, \textbf{ G\+P\+I\+O\+\_\+\+Init\+Type\+Def\+::\+G\+P\+I\+O\+\_\+\+O\+Type}, \textbf{ G\+P\+I\+O\+\_\+\+O\+Type\+\_\+\+OD}, \textbf{ G\+P\+I\+O\+\_\+\+Init\+Type\+Def\+::\+G\+P\+I\+O\+\_\+\+Pin}, \textbf{ G\+P\+I\+O\+\_\+\+Pin\+A\+F\+Config()}, \textbf{ G\+P\+I\+O\+\_\+\+Init\+Type\+Def\+::\+G\+P\+I\+O\+\_\+\+Pu\+Pd}, \textbf{ G\+P\+I\+O\+\_\+\+Pu\+Pd\+\_\+\+N\+O\+P\+U\+LL}, \textbf{ G\+P\+I\+O\+\_\+\+Init\+Type\+Def\+::\+G\+P\+I\+O\+\_\+\+Speed}, \textbf{ G\+P\+I\+O\+\_\+\+Speed\+\_\+100\+M\+Hz}, \textbf{ I2\+C\+\_\+\+Init\+Type\+Def\+::\+I2\+C\+\_\+\+Ack}, \textbf{ I2\+C\+\_\+\+Init\+Type\+Def\+::\+I2\+C\+\_\+\+Acknowledged\+Address}, \textbf{ I2\+C\+\_\+\+Init\+Type\+Def\+::\+I2\+C\+\_\+\+Clock\+Speed}, \textbf{ I2\+C\+\_\+\+Cmd()}, \textbf{ I2\+C\+\_\+\+De\+Init()}, \textbf{ I2\+C\+\_\+\+Init\+Type\+Def\+::\+I2\+C\+\_\+\+Duty\+Cycle}, \textbf{ I2\+C\+\_\+\+Init()}, \textbf{ I2\+C\+\_\+\+Init\+Type\+Def\+::\+I2\+C\+\_\+\+Mode}, \textbf{ I2\+C\+\_\+\+Init\+Type\+Def\+::\+I2\+C\+\_\+\+Own\+Address1}, \textbf{ R\+C\+C\+\_\+\+A\+H\+B1\+Periph\+Clock\+Cmd()}, and \textbf{ R\+C\+C\+\_\+\+A\+P\+B1\+Periph\+Clock\+Cmd()}.



Referenced by \textbf{ board\+\_\+init()}.


\begin{DoxyCode}
00054 \{
00055   GPIO_InitTypeDef GPIO\_InitStructure;
00056   I2C_InitTypeDef I2C\_InitStructure;
00057 
00058     \textcolor{comment}{/* Enable I2Cx clock */}
00059   RCC_APB1PeriphClockCmd(SENSORS_I2C_RCC_CLK, ENABLE);
00060 
00061   \textcolor{comment}{/* Enable I2C GPIO clock */}
00062   RCC_AHB1PeriphClockCmd(SENSORS_I2C_SCL_GPIO_CLK | SENSORS_I2C_SDA_GPIO_CLK, 
      ENABLE);
00063 
00064   \textcolor{comment}{/* Configure I2Cx pin: SCL ----------------------------------------*/}
00065   GPIO\_InitStructure.GPIO_Pin =  SENSORS_I2C_SCL_GPIO_PIN; 
00066   GPIO\_InitStructure.GPIO_Mode = GPIO_Mode_AF;
00067   GPIO\_InitStructure.GPIO_Speed = GPIO_Speed_100MHz;
00068   GPIO\_InitStructure.GPIO_OType = GPIO_OType_OD;
00069   GPIO\_InitStructure.GPIO_PuPd  = GPIO_PuPd_NOPULL;
00070 
00071   \textcolor{comment}{/* Connect pins to Periph */}
00072   GPIO_PinAFConfig(SENSORS_I2C_SCL_GPIO_PORT, SENSORS_I2C_SCL_GPIO_PINSOURCE, 
      SENSORS_I2C_AF);  
00073   GPIO_Init(SENSORS_I2C_SCL_GPIO_PORT, &GPIO\_InitStructure);
00074 
00075   \textcolor{comment}{/* Configure I2Cx pin: SDA ----------------------------------------*/}
00076   GPIO\_InitStructure.GPIO_Pin = SENSORS_I2C_SDA_GPIO_PIN; 
00077 
00078   \textcolor{comment}{/* Connect pins to Periph */}
00079   GPIO_PinAFConfig(SENSORS_I2C_SDA_GPIO_PORT, SENSORS_I2C_SDA_GPIO_PINSOURCE, 
      SENSORS_I2C_AF);  
00080   GPIO_Init(SENSORS_I2C_SDA_GPIO_PORT, &GPIO\_InitStructure);  
00081   
00082   I2C_DeInit(SENSORS_I2C);
00083   I2C\_InitStructure.I2C_Mode = I2C_Mode_I2C;
00084   I2C\_InitStructure.I2C_DutyCycle = I2C_DutyCycle_2;
00085   I2C\_InitStructure.I2C_OwnAddress1 = I2C_OWN_ADDRESS;
00086   I2C\_InitStructure.I2C_Ack = I2C_Ack_Enable;
00087   I2C\_InitStructure.I2C_AcknowledgedAddress = I2C_AcknowledgedAddress_7bit;
00088   I2C\_InitStructure.I2C_ClockSpeed = I2C_SPEED;
00089     
00090   \textcolor{comment}{/* Enable the I2C peripheral */}
00091   I2C_Cmd(SENSORS_I2C, ENABLE);  
00092     
00093   \textcolor{comment}{/* Initialize the I2C peripheral */}
00094   I2C_Init(SENSORS_I2C, &I2C\_InitStructure);
00095   
00096   \textcolor{keywordflow}{return};
00097 \}
\end{DoxyCode}
\mbox{\label{i2c_8h_a5cbe0388e76a86986a11311ebb9cee2f}} 
\index{i2c.\+h@{i2c.\+h}!Sensors\+\_\+\+I2\+C\+\_\+\+Read\+Register@{Sensors\+\_\+\+I2\+C\+\_\+\+Read\+Register}}
\index{Sensors\+\_\+\+I2\+C\+\_\+\+Read\+Register@{Sensors\+\_\+\+I2\+C\+\_\+\+Read\+Register}!i2c.\+h@{i2c.\+h}}
\subsubsection{Sensors\+\_\+\+I2\+C\+\_\+\+Read\+Register()}
{\footnotesize\ttfamily int Sensors\+\_\+\+I2\+C\+\_\+\+Read\+Register (\begin{DoxyParamCaption}\item[{unsigned char}]{Address,  }\item[{unsigned char}]{Register\+Addr,  }\item[{unsigned short}]{Register\+Len,  }\item[{unsigned char $\ast$}]{Register\+Value }\end{DoxyParamCaption})}



Definition at line \textbf{ 157} of file \textbf{ i2c.\+c}.



References \textbf{ Get\+\_\+\+I2\+C\+\_\+\+Retry()}, \textbf{ mdelay()}, and \textbf{ S\+T\+\_\+\+Sensors\+\_\+\+I2\+C\+\_\+\+Read\+Register()}.


\begin{DoxyCode}
00161 \{
00162   \textcolor{keywordtype}{char} retries=0;
00163   \textcolor{keywordtype}{int} ret = 0;
00164   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} retry\_in\_mlsec = Get_I2C_Retry();
00165   
00166 tryReadAgain:  
00167   ret = 0;
00168   ret = ST_Sensors_I2C_ReadRegister( slave\_addr, reg\_addr, len, data\_ptr);
00169 
00170   \textcolor{keywordflow}{if}(ret && retry\_in\_mlsec)
00171   \{
00172     \textcolor{keywordflow}{if}( retries++ > 4 )
00173         \textcolor{keywordflow}{return} ret;
00174     
00175     mdelay(retry\_in\_mlsec);
00176     \textcolor{keywordflow}{goto} tryReadAgain;
00177   \} 
00178   \textcolor{keywordflow}{return} ret;
00179 \}
\end{DoxyCode}
\mbox{\label{i2c_8h_a770c100a15fc6f10e0ce66586db69f8a}} 
\index{i2c.\+h@{i2c.\+h}!Sensors\+\_\+\+I2\+C\+\_\+\+Write\+Register@{Sensors\+\_\+\+I2\+C\+\_\+\+Write\+Register}}
\index{Sensors\+\_\+\+I2\+C\+\_\+\+Write\+Register@{Sensors\+\_\+\+I2\+C\+\_\+\+Write\+Register}!i2c.\+h@{i2c.\+h}}
\subsubsection{Sensors\+\_\+\+I2\+C\+\_\+\+Write\+Register()}
{\footnotesize\ttfamily int Sensors\+\_\+\+I2\+C\+\_\+\+Write\+Register (\begin{DoxyParamCaption}\item[{unsigned char}]{Address,  }\item[{unsigned char}]{Register\+Addr,  }\item[{unsigned short}]{Register\+Len,  }\item[{const unsigned char $\ast$}]{Register\+Value }\end{DoxyParamCaption})}



Definition at line \textbf{ 133} of file \textbf{ i2c.\+c}.



References \textbf{ Get\+\_\+\+I2\+C\+\_\+\+Retry()}, \textbf{ mdelay()}, and \textbf{ S\+T\+\_\+\+Sensors\+\_\+\+I2\+C\+\_\+\+Write\+Register()}.


\begin{DoxyCode}
00137 \{
00138   \textcolor{keywordtype}{char} retries=0;
00139   \textcolor{keywordtype}{int} ret = 0;
00140   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} retry\_in\_mlsec = Get_I2C_Retry();
00141                               
00142 tryWriteAgain:  
00143   ret = 0;
00144   ret = ST_Sensors_I2C_WriteRegister( slave\_addr, reg\_addr, len, data\_ptr); 
00145 
00146   \textcolor{keywordflow}{if}(ret && retry\_in\_mlsec)
00147   \{
00148     \textcolor{keywordflow}{if}( retries++ > 4 )
00149         \textcolor{keywordflow}{return} ret;
00150     
00151     mdelay(retry\_in\_mlsec);
00152     \textcolor{keywordflow}{goto} tryWriteAgain;
00153   \}
00154   \textcolor{keywordflow}{return} ret;  
00155 \}
\end{DoxyCode}
\mbox{\label{i2c_8h_a463aa366d8082caef51ff67c162c0a19}} 
\index{i2c.\+h@{i2c.\+h}!Set\+\_\+\+I2\+C\+\_\+\+Retry@{Set\+\_\+\+I2\+C\+\_\+\+Retry}}
\index{Set\+\_\+\+I2\+C\+\_\+\+Retry@{Set\+\_\+\+I2\+C\+\_\+\+Retry}!i2c.\+h@{i2c.\+h}}
\subsubsection{Set\+\_\+\+I2\+C\+\_\+\+Retry()}
{\footnotesize\ttfamily void Set\+\_\+\+I2\+C\+\_\+\+Retry (\begin{DoxyParamCaption}\item[{unsigned short}]{ml\+\_\+sec }\end{DoxyParamCaption})}



Definition at line \textbf{ 403} of file \textbf{ i2c.\+c}.



References \textbf{ R\+E\+T\+R\+Y\+\_\+\+I\+N\+\_\+\+M\+L\+S\+EC}.



Referenced by \textbf{ board\+\_\+init()}.


\begin{DoxyCode}
00404 \{
00405   RETRY_IN_MLSEC = ml\_sec;
00406 \}
\end{DoxyCode}
